<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Sergio Vignali, Arnaud Barras &amp; Veronika Braunisch" />


<title>SDMtune - basic use</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">SDMtune - basic use</h1>
<h4 class="author">Sergio Vignali, Arnaud Barras &amp; Veronika
Braunisch</h4>


<div id="TOC">
<ul>
<li><a href="#prepare-data-for-the-analysis" id="toc-prepare-data-for-the-analysis">Prepare data for the analysis</a>
<ul>
<li><a href="#acquire-environmental-variables" id="toc-acquire-environmental-variables">Acquire environmental
variables</a></li>
<li><a href="#prepare-presence-and-background-locations" id="toc-prepare-presence-and-background-locations">Prepare presence and
background locations</a></li>
<li><a href="#create-an-swd-object" id="toc-create-an-swd-object">Create
an SWD object</a></li>
<li><a href="#explore-the-swd-object" id="toc-explore-the-swd-object">Explore the SWD object</a></li>
<li><a href="#save-an-swd-object" id="toc-save-an-swd-object">Save an
SWD object</a></li>
</ul></li>
<li><a href="#train-a-model" id="toc-train-a-model">Train a model</a>
<ul>
<li><a href="#train-a-model-with-default-settings" id="toc-train-a-model-with-default-settings">Train a model with default
settings</a></li>
<li><a href="#explore-an-sdmmodel-object" id="toc-explore-an-sdmmodel-object">Explore an SDMmodel object</a></li>
<li><a href="#train-a-model-changing-the-default-settings" id="toc-train-a-model-changing-the-default-settings">Train a model
changing the default settings</a></li>
</ul></li>
<li><a href="#make-prediction" id="toc-make-prediction">Make
prediction</a>
<ul>
<li><a href="#create-a-distribution-map" id="toc-create-a-distribution-map">Create a distribution map</a></li>
<li><a href="#plot-a-distribution-map" id="toc-plot-a-distribution-map">Plot a distribution map</a></li>
<li><a href="#plot-a-presenceabsence-map" id="toc-plot-a-presenceabsence-map">Plot a presence/absence map</a></li>
</ul></li>
<li><a href="#evaluate-a-model" id="toc-evaluate-a-model">Evaluate a
model</a>
<ul>
<li><a href="#auc" id="toc-auc">AUC</a></li>
<li><a href="#tss" id="toc-tss">TSS</a></li>
<li><a href="#aicc" id="toc-aicc">AICc</a></li>
<li><a href="#training-and-testing" id="toc-training-and-testing">Training and testing</a></li>
<li><a href="#cross-validation" id="toc-cross-validation">Cross
validation</a></li>
<li><a href="#spatial-cross-validation" id="toc-spatial-cross-validation">Spatial Cross Validation</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<div id="prepare-data-for-the-analysis" class="section level1">
<h1>Prepare data for the analysis</h1>
<p>In this section you will learn how to prepare the data to train
models using <code>SDMtune</code>. We will use the
<code>virtualSp</code> dataset included in the package and environmental
predictors from the <a href="https://www.worldclim.org/">WorldClim</a>
dataset.</p>
<p>First let’s load some packages that we will use to visualize the
data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)    <span class="co"># To plot locations</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)       <span class="co"># To access useful maps</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rasterVis)  <span class="co"># To plot raster objects</span></span></code></pre></div>
<div id="acquire-environmental-variables" class="section level2">
<h2>Acquire environmental variables</h2>
<p>We use the climate data of <a href="https://www.worldclim.org/">WorldClim</a> version 1.4 <span class="citation">(Hijmans et al. 2005)</span> and the <a href="https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world">terrestrial
ecoregions</a> from WWF <span class="citation">(Olson et al.
2001)</span> included in the <code>dismo</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">file.path</span>(<span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;dismo&quot;</span>), <span class="st">&quot;ex&quot;</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">&quot;grd&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We convert these files in a <code>raster stack</code> object that
will be used later in the analysis:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(files)</span></code></pre></div>
<p>There are nine environmental variables, eight continuous and one
categorical:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictors)</span></code></pre></div>
<ul>
<li>Continuous variables
<ul>
<li><strong>bio1</strong> Annual Mean Temperature</li>
<li><strong>bio5</strong> Max Temperature of Warmest Month</li>
<li><strong>bio6</strong> Min Temperature of Coldest Month</li>
<li><strong>bio7</strong> Temperature Annual Range (bio5-bio6)</li>
<li><strong>bio8</strong> Mean Temperature of Wettest Quarter</li>
<li><strong>bio12</strong> Annual Precipitation</li>
<li><strong>bio16</strong> Precipitation of Wettest Quarter</li>
<li><strong>bio17</strong> Precipitation of Driest Quarter</li>
</ul></li>
<li>Categorical variables
<ul>
<li><strong>biome</strong> Terrestrial Ecoregions of the World</li>
</ul></li>
</ul>
<p>We can plot <strong>bio1</strong> using the <code>gplot</code>
function from the <code>rasterVis</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gplot</span>(predictors<span class="sc">$</span>bio1) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;#2c7bb6&quot;</span>, <span class="st">&quot;#abd9e9&quot;</span>, <span class="st">&quot;#ffffbf&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#d7191c&quot;</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">na.value =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name =</span> <span class="st">&quot;°C x 10&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Annual Mean Temperature&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
</div>
<div id="prepare-presence-and-background-locations" class="section level2">
<h2>Prepare presence and background locations</h2>
<p>Let’s load the <strong>SDMtune</strong> package:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SDMtune)</span></code></pre></div>
<p>For demonstrating how to use <code>SDMtune</code> we use the random
generated <code>virtualSp</code> dataset included in the package.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(virtualSp)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p_coords <span class="ot">&lt;-</span> virtualSp<span class="sc">$</span>presence</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>bg_coords <span class="ot">&lt;-</span> virtualSp<span class="sc">$</span>background</span></code></pre></div>
<p>Plot the study area together with the presence locations:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>), <span class="fu">aes</span>(long, lat)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group), <span class="at">fill =</span> <span class="st">&quot;grey95&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray40&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">data =</span> p_coords, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">32</span>)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">56</span>, <span class="dv">40</span>))</span></code></pre></div>
<p>To plot the background locations run the following code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>), <span class="fu">aes</span>(long, lat)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group), <span class="at">fill =</span> <span class="st">&quot;grey95&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray40&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(bg_coords), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">32</span>)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">56</span>, <span class="dv">40</span>))</span></code></pre></div>
</div>
<div id="create-an-swd-object" class="section level2">
<h2>Create an SWD object</h2>
<p>Before training a model we have to prepare the data in the correct
format. The <code>prepareSWD</code> function creates an <code>SWD</code>
object that stores the species’ name, the coordinates of the species at
presence and absence/background locations and the value of the
environmental variables at the locations. The argument
<code>categorical</code> indicates which environmental variables are
categorical. In our example <strong>biome</strong> is categorical (we
can pass a vector if we have more than one categorical environmental
variable). The function extracts the value of the environmental
variables for each location and excludes those locations that have
<code>NA</code> value for at least one environmental variable.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">prepareSWD</span>(<span class="at">species =</span> <span class="st">&quot;Virtual species&quot;</span>, <span class="at">p =</span> p_coords, <span class="at">a =</span> bg_coords,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">env =</span> predictors, <span class="at">categorical =</span> <span class="st">&quot;biome&quot;</span>)</span></code></pre></div>
</div>
<div id="explore-the-swd-object" class="section level2">
<h2>Explore the SWD object</h2>
<p>Let’s have a look at the <code>SWD</code> object that we have just
created:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<p>When we print an <code>SWD</code> object we get a bunch of
information:</p>
<ul>
<li>the name of the class;</li>
<li>the name of the species;</li>
<li>the number of presence locations;</li>
<li>the number of absence/background locations;</li>
<li>the environmental variables available in the dataset:
<ul>
<li>the name of the continuous environmental variables, if any;</li>
<li>the name of the categorical environmental variables, if any.</li>
</ul></li>
</ul>
<p>The object contains four slots: <code>@species</code>,
<code>@coords</code> <code>@data</code> and <code>@pa</code>.
<code>@pa</code> contains a vector with 1 for presence and 0 for
absence/background locations. To visualize the data we run:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">@</span>data)</span></code></pre></div>
<p>We can visualize the coordinates with:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">@</span>coords)</span></code></pre></div>
<p>or the name of the species with:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">@</span>species</span></code></pre></div>
</div>
<div id="save-an-swd-object" class="section level2">
<h2>Save an SWD object</h2>
<p>We can save the <code>SWD</code> object in a <strong>.csv</strong>
file using the function <code>swd2csv</code> (the function saves the
file in the working directory). There are two possibilities:</p>
<ul>
<li>save the object in a single file with the column <strong>pa</strong>
indicating if the location is a presence (1) or an absence/background
(0) site</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">swd2csv</span>(data, <span class="at">file_name =</span> <span class="st">&quot;data.csv&quot;</span>)</span></code></pre></div>
<ul>
<li>save the object in two separate files: one for the presence and the
other for the absence/background locations</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">swd2csv</span>(data, <span class="at">file_name =</span> <span class="fu">c</span>(<span class="st">&quot;presence.csv&quot;</span>, <span class="st">&quot;background.csv&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="train-a-model" class="section level1">
<h1>Train a model</h1>
<p><code>SDMtune</code> supports four methods for model training:</p>
<ul>
<li>Artificial Neural Networks <strong>ANN</strong>, using the
<code>nnet</code> package <span class="citation">(Venables and Ripley
2002)</span>;</li>
<li>Boosted Regression Trees <strong>BRT</strong>, using the
<code>gbm</code> package <span class="citation">(Greenwell et al.
2019)</span>;</li>
<li>Maximum Entropy with two implementations:
<ul>
<li><strong>Maxent</strong> using the <code>dismo</code> package <span class="citation">(Hijmans et al. 2017)</span>;</li>
<li><strong>Maxnet</strong> using the <code>maxnet</code> package <span class="citation">(Phillips 2017)</span>;</li>
</ul></li>
<li>Random Forest <strong>RF</strong>, using the
<code>randomForest</code> package <span class="citation">(Liaw and
Wiener 2002)</span>.</li>
</ul>
<p>The code necessary to train a model is the same for all the
implementations. We will show how to train a <strong>Maxent</strong>
model, you can adapt the code for the other methods or check the
<code>presence absence models</code> vignette.</p>
<div id="train-a-model-with-default-settings" class="section level2">
<h2>Train a model with default settings</h2>
<p>We use the function <code>train</code> to train a
<strong>Maxent</strong> model. We need to provide two arguments:</p>
<ul>
<li><code>method</code>: “Maxent” in our case;</li>
<li><code>data</code>: the <code>SWD</code> object with the presence and
background locations.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data)</span></code></pre></div>
<p>The function trains the model using default settings that are:</p>
<ul>
<li>linear, quadratic, product and hinge feature class
combinations;</li>
<li>regularization multiplier equal to 1;</li>
<li>500 algorithm iterations.</li>
</ul>
<p>We will see later how to change the default settings, for the moment
let’s have a look at the <code>model</code> object.</p>
</div>
<div id="explore-an-sdmmodel-object" class="section level2">
<h2>Explore an SDMmodel object</h2>
<p>The output of the function <code>train</code> is an object of class
<code>SDMmodel</code>. Let’s print the <code>model</code> object we’ve
just created:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model</span></code></pre></div>
<p>When we print an <code>SDMmodel</code> object we get the following
information:</p>
<ul>
<li>the name of the class;</li>
<li>the method used to train the model;</li>
<li>the name of the species;</li>
<li>the number of presence locations;</li>
<li>the number of absence/background locations;</li>
<li>the model configurations:
<ul>
<li>fc: the feature class combinations;</li>
<li>reg: the regularization multiplier;</li>
<li>iter: the number of iterations;</li>
</ul></li>
<li>the environmental variables used to train the model:
<ul>
<li>the name of the continuous environmental variables, if any;</li>
<li>the name of the categorical environmental variables, if any.</li>
</ul></li>
</ul>
<p>An <code>SDMmodel</code> object has two slots:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slotNames</span>(model)</span></code></pre></div>
<ul>
<li><strong>data</strong>: an <code>SWD</code> object with the presence
absence/background locations used to train the model;</li>
<li><strong>model</strong>: a <code>Maxent</code> object, in our case,
with all the model configurations.</li>
</ul>
<p>The slot <code>model</code> contains the configurations of the model
plus other information used to make predictions.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slotNames</span>(model<span class="sc">@</span>model)</span></code></pre></div>
<p>The most important are: <strong>fc</strong>, <strong>reg</strong> and
<strong>iter</strong> that contain the values of the model
configuration.</p>
</div>
<div id="train-a-model-changing-the-default-settings" class="section level2">
<h2>Train a model changing the default settings</h2>
<p>The function <code>train()</code> accepts optional arguments that can
be used to change the default model settings. In our previous example we
could have trained the same model using:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">fc =</span> <span class="st">&quot;lqph&quot;</span>, <span class="at">reg =</span> <span class="dv">1</span>, <span class="at">iter =</span> <span class="dv">500</span>)</span></code></pre></div>
<p>In the following example we train a model using linear and hinge as
feature class combination, 0.5 as regularization multiplier and 700
iterations:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">fc =</span> <span class="st">&quot;lh&quot;</span>, <span class="at">reg =</span> <span class="fl">0.5</span>, <span class="at">iter =</span> <span class="dv">700</span>)</span></code></pre></div>
<p>By default Maxent models are trained using the arguments
<em>“removeduplicates=false”</em> and
<em>“addsamplestobackground=false”</em>. The user should have the full
control of the data used to train the model, so is expected that
duplicated locations are already removed and that the presence locations
are already included in the background locations, when desired. You can
use the function <code>thinData</code> to remove duplicated locations
and the function <code>addSamplesToBg</code> to add the presence
locations to the background locations.</p>
</div>
</div>
<div id="make-prediction" class="section level1">
<h1>Make prediction</h1>
<p>New locations are predicted with the function <code>predict</code>.
The function takes three main arguments:</p>
<ul>
<li>a trained model given as <code>SDMmodel</code> object;</li>
<li>a new dataset, used to make prediction (can be a
<code>data.frame</code>, an <code>SWD</code> object or a raster
<code>stack</code> object);</li>
<li>the output type, that for <strong>Maxent</strong> models can be:
<strong>raw</strong>, <strong>logistic</strong> or
<strong>cloglog</strong>.</li>
</ul>
<p>Next we get the prediction for our training locations using the
<strong>cloglog</strong> output type:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">data =</span> data, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>)</span></code></pre></div>
<p>The output in this case is a vector containing all the predicted
values for the training locations:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred)</span></code></pre></div>
<p>We can get the prediction only for the presence location with:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> data<span class="sc">@</span>data[data<span class="sc">@</span>pa <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">data =</span> p, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(pred)</span></code></pre></div>
<p>For models trained with the <strong>Maxent</strong> method, the
function performs the prediction in R without calling the MaxEnt Java
software. This results in a faster computation for large datasets and
might result in a slightly different output compared to the Java
software.</p>
<div id="create-a-distribution-map" class="section level2">
<h2>Create a distribution map</h2>
<p>We can use the same function to create a distribution map starting
from the <code>predictors</code> raster `stack’ object:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">data =</span> predictors, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>)</span></code></pre></div>
<p>In this case the output is a <code>raster</code> object:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>map</span></code></pre></div>
<p>The map can be saved in a file directly when running the prediction,
we just have to pass additional arguments to the <code>predict</code>
function. In the next example we save the map in a file called
“<strong>my_file</strong>” in the <strong>GeoTIFF</strong> format:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">data =</span> predictors, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>, <span class="at">file =</span> <span class="st">&quot;my_map&quot;</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">format =</span> <span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>The function <code>predict</code> has other arguments useful when
predicting large datasets:</p>
<ul>
<li><strong>progress</strong>: can be set to <code>&quot;text&quot;</code> to
visualize a progress bar;</li>
<li><strong>extent</strong>: can be passed to reduce the prediction to
the given extent.</li>
</ul>
<p>In the next example we restrict the prediction to Chile and plot the
prediction:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First create the extent that surrounds Cile</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">extent</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">60</span>, <span class="sc">-</span><span class="dv">56</span>, <span class="sc">-</span><span class="dv">15</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use the extent to make the prediction</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>map_e <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">data =</span> predictors, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>, <span class="at">extent =</span> e)</span></code></pre></div>
</div>
<div id="plot-a-distribution-map" class="section level2">
<h2>Plot a distribution map</h2>
<p>To plot the distribution map we can use the function
<code>plotPred</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPred</span>(map)</span></code></pre></div>
<p>The function <code>plotPred</code> plots a map with a color ramp
similar to the one used by the MaxEnt Java software. We can pass
additional arguments to customize the map. In the next example we
provide a custom color ramp and we add a title to the legend:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPred</span>(map, <span class="at">lt =</span> <span class="st">&quot;Habitat</span><span class="sc">\n</span><span class="st">suitability&quot;</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">colorramp =</span> <span class="fu">c</span>(<span class="st">&quot;#2c7bb6&quot;</span>, <span class="st">&quot;#abd9e9&quot;</span>, <span class="st">&quot;#ffffbf&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#d7191c&quot;</span>))</span></code></pre></div>
</div>
<div id="plot-a-presenceabsence-map" class="section level2">
<h2>Plot a presence/absence map</h2>
<p>To plot a presence/absence map we need a threshold value that splits
the prediction in presence and absence values. The function
<code>thresholds</code> returns some commonly used threshold values
starting from an <code>SDMmodel</code> object. In the next example we
print the threshold values using the type <code>&quot;cloglog&quot;</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ths <span class="ot">&lt;-</span> <span class="fu">thresholds</span>(model, <span class="at">type =</span> <span class="st">&quot;cloglog&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ths</span></code></pre></div>
<p>For example we want to create a presence/absence map using the
threshold that maximize the training sensitivity plus specificity. We
use the function <code>plotPA</code> passing the threshold value as
argument:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPA</span>(map, <span class="at">th =</span> ths[<span class="dv">3</span>, <span class="dv">2</span>])</span></code></pre></div>
<p>We can also save the map in a file with the following code:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPA</span>(map, <span class="at">th =</span> ths[<span class="dv">3</span>, <span class="dv">2</span>], <span class="at">filename =</span> <span class="st">&quot;my_pa_map&quot;</span>, <span class="at">format =</span> <span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Both functions <code>plotPred</code> and <code>plotPA</code> have the
argument <code>hr</code>to plot the the map with high resolution, useful
when the map is used in a scientific publication.</p>
</div>
</div>
<div id="evaluate-a-model" class="section level1">
<h1>Evaluate a model</h1>
<p><code>SDMtune</code> implements three evaluation metrics:</p>
<ul>
<li>AUC: Area Under the ROC curve <span class="citation">(Fielding and
Bell 1997)</span></li>
<li>TSS: True Skill Statistic <span class="citation">(Allouche, Tsoar,
and Kadmon 2006)</span></li>
<li>AICc: Akaike Information Criterion corrected for small sample size
<span class="citation">(Warren and Seifert 2011)</span></li>
</ul>
<p>We will compute the value of the metrics on the training dataset.</p>
<div id="auc" class="section level2">
<h2>AUC</h2>
<p>The AUC can be calculated using the function <code>auc</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(model)</span></code></pre></div>
<p>We can also plot the ROC curve using the function
<code>plotROC</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(model)</span></code></pre></div>
</div>
<div id="tss" class="section level2">
<h2>TSS</h2>
<p>The TSS is computed with the function <code>tss</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tss</span>(model)</span></code></pre></div>
</div>
<div id="aicc" class="section level2">
<h2>AICc</h2>
<p>For the AICc we use the function <code>aicc</code>. In this case we
need to pass to the <code>env</code> argument the
<code>predictors</code> raster <code>stack</code> object:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aicc</span>(model, <span class="at">env =</span> predictors)</span></code></pre></div>
</div>
<div id="training-and-testing" class="section level2">
<h2>Training and testing</h2>
<p>It’s always a good practice to split the species locations into two
parts and use one part to train the model and the remaining part to
evaluate it. We can use the <code>trainValTest</code> function for this
purpose. Let’s say we want to use 80% of the species locations to train
our model and 20% as testing dataset to evaluate it:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zeallot)  <span class="co"># For unpacking assignment</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(train, test) <span class="sc">%&lt;-%</span> <span class="fu">trainValTest</span>(data, <span class="at">test =</span> <span class="fl">0.2</span>, <span class="at">only_presence =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">seed =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>Now we train the model using the <code>train</code> dataset:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> train)</span></code></pre></div>
<p>The <code>only_presence</code> argument is used to split only the
presence and not the background locations. We can now evaluate the model
using the testing dataset that has not been used to train the model:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(model)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(model, <span class="at">test =</span> test)</span></code></pre></div>
<p>We can plot the ROC curve for both, training and testing datasets,
with:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(model, <span class="at">test =</span> test)</span></code></pre></div>
<p>This approach is valid when we have a large dataset. In our case,
with only few observations, the evaluation depends strongly on how we
split our presence locations. Let’s run a small experiment in which we
perform different train/test splits and we compute the AUC:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty data.frame</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">3</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(output) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;seed&quot;</span>, <span class="st">&quot;trainAUC&quot;</span>, <span class="st">&quot;testAUC&quot;</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 different random seeds</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="dv">1000</span>, <span class="dv">10</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the seeds</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(seeds)) {</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the train/test split</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(train, test) <span class="sc">%&lt;-%</span> <span class="fu">trainValTest</span>(data, <span class="at">test =</span> <span class="fl">0.2</span>, <span class="at">seed =</span> seeds[i],</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">only_presence =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train the model</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> train)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Populate the output data.frame</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  output[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> seeds[i]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  output[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">auc</span>(m)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  output[i, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">auc</span>(m, <span class="at">test =</span> test)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the output</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>output</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the range of the testing AUC</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(output[, <span class="dv">3</span>])</span></code></pre></div>
<p>The testing AUC varies for the different train/test partitions. When
we have to deal with a small dataset a better approach is the cross
validation.</p>
</div>
<div id="cross-validation" class="section level2">
<h2>Cross validation</h2>
<p>To perform a cross validation in <strong>SDMtune</strong> we have to
pass the <code>fold</code> argument to the <code>train</code> function.
First we have to create the folds. There are several way to create them,
here we explain how to make a random partition of 4 folds using the
function <code>randomFolds</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">randomFolds</span>(data, <span class="at">k =</span> <span class="dv">4</span>, <span class="at">only_presence =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>The output of the function is a list containing two matrices, the
first for the training and the second for the testing locations. Each
column of one matrix represents a fold with <code>TRUE</code> for the
locations included in and <code>FALSE</code> excluded from the
partition.</p>
<p>Let’s perform a 4 fold cross validation using the
<strong>Maxent</strong> method (note that we use the full dataset):</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cv_model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">folds =</span> folds)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>cv_model</span></code></pre></div>
<p>The output in this case is an <code>SDMmodelCV</code> object. It
contains the four trained models in the <code>models</code> slot and the
fold partitions in the <code>folds</code> slot. We can compute the AUC
of a <code>SDMmodelCV</code> object using:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(cv_model)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(cv_model, <span class="at">test =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>this returns the AUC value averaged across the four different
models.</p>
</div>
<div id="spatial-cross-validation" class="section level2">
<h2>Spatial Cross Validation</h2>
<p>The <code>train()</code> function accepts folds created with two
other packages:</p>
<ul>
<li><code>ENMeval</code> <span class="citation">(Muscarella et al.
2014)</span></li>
<li><code>blockCV</code> <span class="citation">(Valavi et al.
2019)</span></li>
</ul>
<p>The function will convert internally the created folds into the
correct format for <code>SDMtune</code>. These packages have specific
function to create folds partitions that are spatially or
environmentally independent.</p>
<p>Block partition using the <code>ENMeval</code> package:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ENMeval)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>block_folds <span class="ot">&lt;-</span> <span class="fu">get.block</span>(<span class="at">occ =</span> data<span class="sc">@</span>coords[data<span class="sc">@</span>pa <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bg.coords =</span> data<span class="sc">@</span>coords[data<span class="sc">@</span>pa <span class="sc">==</span> <span class="dv">0</span>, ])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">fc =</span> <span class="st">&quot;l&quot;</span>, <span class="at">reg =</span> <span class="fl">0.8</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">folds =</span> block_folds)</span></code></pre></div>
<p>Checkerboard1 partition using the <code>ENMeval</code> package:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cb_folds <span class="ot">&lt;-</span> <span class="fu">get.checkerboard1</span>(<span class="at">occ =</span> data<span class="sc">@</span>coords[data<span class="sc">@</span>pa <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">env =</span> predictors,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bg.coords =</span> data<span class="sc">@</span>coords[data<span class="sc">@</span>pa <span class="sc">==</span> <span class="dv">0</span>, ],</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">aggregation.factor =</span> <span class="dv">4</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">fc =</span> <span class="st">&quot;l&quot;</span>, <span class="at">reg =</span> <span class="fl">0.8</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">folds =</span> cb_folds)</span></code></pre></div>
<p>Environmental block using the package <code>blockCV</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blockCV)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial points data frame</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>sp_df <span class="ot">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span>(data<span class="sc">@</span>coords,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> <span class="fu">as.data.frame</span>(data<span class="sc">@</span>pa),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">proj4string =</span> <span class="fu">crs</span>(predictors))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>e_folds <span class="ot">&lt;-</span> <span class="fu">envBlock</span>(<span class="at">rasterLayer =</span> predictors, <span class="at">speciesData =</span> sp_df,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">species =</span> <span class="st">&quot;data@pa&quot;</span>, <span class="at">k =</span> <span class="dv">4</span>, <span class="at">standardization =</span> <span class="st">&quot;standard&quot;</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rasterBlock =</span> <span class="cn">FALSE</span>, <span class="at">numLimit =</span> <span class="dv">100</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">method =</span> <span class="st">&quot;Maxent&quot;</span>, <span class="at">data =</span> data, <span class="at">fc =</span> <span class="st">&quot;l&quot;</span>, <span class="at">reg =</span> <span class="fl">0.8</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">folds =</span> e_folds)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ALLOUCHE2006" class="csl-entry">
Allouche, Omri, Asaf Tsoar, and Ronen Kadmon. 2006. <span>“Assessing the
Accuracy of Species Distribution Models: Prevalence, Kappa and the True
Skill Statistic (TSS).”</span> <em>Journal of Applied Ecology</em> 43
(6): 1223–32. https://doi.org/<a href="https://doi.org/10.1111/j.1365-2664.2006.01214.x">https://doi.org/10.1111/j.1365-2664.2006.01214.x</a>.
</div>
<div id="ref-Fielding1997" class="csl-entry">
Fielding, Alan H., and John F. Bell. 1997. <span>“<span class="nocase">A
review of methods for the assessment of prediction errors in
conservation presence/absence models</span>.”</span> <em>Environmental
Conservation</em> 24 (1): 38–49.
</div>
<div id="ref-Greenwell2019" class="csl-entry">
Greenwell, Brandon, Bradley Boehmke, Jay Cunningham, and GBM Developers.
2019. <span>“<span class="nocase">gbm: Generalized Boosted Regression
Models. R package version 2.1.5</span>.”</span>
https://CRAN.R-project.org/package=gbm.
</div>
<div id="ref-Hijmans2005" class="csl-entry">
Hijmans, Robert J., Susan E. Cameron, Juan L. Parra, Peter G. Jones, and
Andy Jarvis. 2005. <span>“Very High Resolution Interpolated Climate
Surfaces for Global Land Areas.”</span> <em>International Journal of
Climatology</em> 25 (15): 1965–78. https://doi.org/<a href="https://doi.org/10.1002/joc.1276">https://doi.org/10.1002/joc.1276</a>.
</div>
<div id="ref-Hijmans2017" class="csl-entry">
Hijmans, Robert J., Steven Phillips, John Leathwick, and Jane Elith.
2017. <span>“<span class="nocase">dismo: Species Distribution Modeling.
R package version 1.1-4</span>.”</span>
https://cran.r-project.org/package=dismo.
</div>
<div id="ref-Liaw2002" class="csl-entry">
Liaw, Andy, and Matthew Wiener. 2002. <span>“<span class="nocase">Classification and Regression by
randomForest</span>.”</span> <em>R News</em> 2 (3): 18–22.
</div>
<div id="ref-Muscarella2014" class="csl-entry">
Muscarella, Robert, Peter J. Galante, Mariano Soley-Guardia, Robert A.
Boria, Jamie M. Kass, María Uriarte, and Robert P. Anderson. 2014.
<span>“ENMeval: An r Package for Conducting Spatially Independent
Evaluations and Estimating Optimal Model Complexity for Maxent
Ecological Niche Models.”</span> <em>Methods in Ecology and
Evolution</em> 5 (11): 1198–1205. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.12261">https://doi.org/10.1111/2041-210X.12261</a>.
</div>
<div id="ref-Olson2001" class="csl-entry">
Olson, David M., Eric Dinerstein, Eric D. Wikramanayake, Neil D.
Burgess, George V. N. Powell, Emma C. Underwood, Jennifer A. D’amico, et
al. 2001. <span>“<span class="nocase">Terrestrial Ecoregions of the
World: A New Map of Life on Earth</span>.”</span> <em>BioScience</em> 51
(11): 933. <a href="https://doi.org/10.1641/0006-3568(2001)051[0933:TEOTWA]2.0.CO;2">https://doi.org/10.1641/0006-3568(2001)051[0933:TEOTWA]2.0.CO;2</a>.
</div>
<div id="ref-Phillips2017b" class="csl-entry">
Phillips, Steven. 2017. <em><span class="nocase">maxnet: Fitting
’Maxent’ Species Distribution Models with ’glmnet’. R package version
0.1.2</span></em>. https://cran.r-project.org/package=maxnet.
</div>
<div id="ref-Valavi2019" class="csl-entry">
Valavi, Roozbeh, Jane Elith, José J. Lahoz-Monfort, and Gurutzeta
Guillera-Arroita. 2019. <span>“blockCV: An r Package for Generating
Spatially or Environmentally Separated Folds for k-Fold Cross-Validation
of Species Distribution Models.”</span> <em>Methods in Ecology and
Evolution</em> 10 (2): 225–32. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.13107">https://doi.org/10.1111/2041-210X.13107</a>.
</div>
<div id="ref-Venables2002" class="csl-entry">
Venables, W N, and B. D. Ripley. 2002. <em><span class="nocase">Modern
Applied Statistics with S.</span></em> Fourth Edi. New York, NY:
Springer.
</div>
<div id="ref-Warren2011a" class="csl-entry">
Warren, Dan L., and Stephanie N. Seifert. 2011. <span>“Ecological Niche
Modeling in Maxent: The Importance of Model Complexity and the
Performance of Model Selection Criteria.”</span> <em>Ecological
Applications</em> 21 (2): 335–42. https://doi.org/<a href="https://doi.org/10.1890/10-1171.1">https://doi.org/10.1890/10-1171.1</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
